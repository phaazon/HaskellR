machine:
  ghc:
    version: 7.8.3
  environment:
    PATH: ~/.local/bin:$PATH

dependencies:
  pre:
    # Fix the apt-get update sources.list duplicate bug
    - sudo rm /etc/apt/sources.list.d/google-chrome.list
    # pin our release to Ubuntu precise
    - sudo sh -c 'echo "APT::Default-Release \"precise\";" >> /etc/apt/apt.conf'
    - sudo sh -c 'echo "deb http://archive.ubuntu.com/ubuntu precise main restricted universe multiverse\ndeb http://archive.ubuntu.com/ubuntu trusty main restricted universe multiverse" >> /etc/apt/sources.list'
    - "sudo sh -c 'echo \"Package: libzeromq3-dev-4.0.4\nPin:
release n=trusty\nPin-Priority: 900\" > /etc/apt/preferences'"
    # Finally try to install, libzmq3-dev which should now be available
    - sudo apt-get update
    - sudo apt-get install libzmq3-dev
  override:
  - mkdir -p ~/.local/bin
  - curl -L https://github.com/commercialhaskell/stack/releases/download/v0.1.2.0/stack-0.1.2.0-x86_64-linux.gz | gunzip > ~/.local/bin/stack
  - chmod a+x ~/.local/bin/stack
  - stack upgrade --git
  - stack setup --no-terminal
  - stack test --only-snapshot --prefetch --no-terminal
  - stack bench --only-snapshot --prefetch --no-terminal
  - stack haddock --only-snapshot --prefetch --no-terminal

  cache_directories:
  - "~/.stack/"

test:
  override:
  - stack build --haddock --no-terminal
  - stack test --no-terminal
  - stack bench --no-terminal
